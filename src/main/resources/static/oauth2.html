<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>로그인 완료</title>
</head>
<body>
<h1>로그인 처리 중...</h1>
<p>잠시만 기다려 주세요...</p>

<script>
    // 1. URL에서 token 파라미터 추출
    const params = new URLSearchParams(window.location.search);
    const token = params.get("token");
    const code = params.get("code");

    console.log("token", token);
    console.log("code", code);
    // 현재 url
    console.log("current url", window.location.href);

    if (!token) {
        alert("토큰이 없습니다. 로그인에 실패했습니다.");
        // window.location.href = "/";
    } else {
        // 2. 토큰 저장 (여기선 localStorage 사용)
        // localStorage.setItem("jwt", token);
        fetch(`/api/v1/members?code=${code}`)
            .then(response => response.json())
            .then(data => {
                const jwt = data.token.replace("Bearer ", "");
                localStorage.setItem("jwt", jwt);
                window.location.href = "/login-success";
            })
            .catch(error => {
                console.error("로그인 실패", error);
            });


        // 3. 로그인 완료 페이지로 이동
        // window.location.href = "/login-success.html";
    }
</script>
</body>
</html>
